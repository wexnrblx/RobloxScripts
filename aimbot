local plrs = game:GetService("Players")
local TeamBased = _G.teambasedwexnaim 
local teambasedswitch = "o"
local presskeytoaim = true
local aimkey = _G.aimkeybro
local raycast = false
local espupdatetime = 5
local autoesp = false
local lockaim = true
local lockangle = 5

-- GUI oluşturulması
local Gui = Instance.new("ScreenGui")
local Main = Instance.new("Frame")
local st1 = Instance.new("TextLabel")
local st1_3 = Instance.new("TextLabel")

Gui.Name = "Gui"
Gui.Parent = plrs.LocalPlayer:WaitForChild("PlayerGui")

Main.Name = "Main"
Main.Parent = Gui
Main.BackgroundColor3 = Color3.new(0.176471, 0.176471, 0.176471)
Main.BackgroundTransparency = 0.65
Main.Position = UDim2.new(0.005, 0, 0.018, 0)
Main.Size = UDim2.new(0.1, 0, 0.1, 0)
Main.Active = true
Main.Draggable = true

st1.Name = "st1"
st1.Parent = Main
st1.BackgroundColor3 = Color3.new(1, 1, 1)
st1.BackgroundTransparency = 1
st1.Position = UDim2.new(0.271787882, 0, 0, 0)
st1.Size = UDim2.new(0.728211343, 0, 0.161862016, 0)
st1.Font = Enum.Font.ArialBold
st1.Text = "Press aim key to aim"
st1.TextColor3 = Color3.new(0.0431373, 1, 0.0745098)
st1.TextScaled = true
st1.TextSize = 14
st1.TextWrapped = true

st1_3.Name = "st1"
st1_3.Parent = Main
st1_3.BackgroundColor3 = Color3.new(1, 1, 1)
st1_3.BackgroundTransparency = 1
st1_3.Position = UDim2.new(0, 0, 0.18558608, 0)
st1_3.Size = UDim2.new(0.999999881, 0, 0.161862016, 0)
st1_3.Font = Enum.Font.ArialBold
st1_3.Text = ""
st1_3.TextColor3 = Color3.new(0.0431373, 1, 0.0745098)
st1_3.TextScaled = true
st1_3.TextSize = 14
st1_3.TextWrapped = true
local teambasedstatus = st1_3:Clone()
teambasedstatus.Parent = st1_3
teambasedstatus.TextScaled = true
teambasedstatus.Position = UDim2.new(0, 0, 0.694, 0)
teambasedstatus.Text = tostring(TeamBased)

-- Script için varsayılanlar
local plrsforaim = {}
local lplr = game:GetService("Players").LocalPlayer

Gui.ResetOnSpawn = false
Gui.Name = "Chat"
Gui.DisplayOrder = 999
Gui.Parent = plrs.LocalPlayer.PlayerGui

f = {}
local espforlder

f.addesp = function()
    if not espforlder then
        espforlder = Instance.new("Folder")
        espforlder.Parent = game.Workspace.CurrentCamera
    end
    for i, v in pairs(espforlder:GetChildren()) do
        v:Destroy()
    end
    for _, plr in pairs(plrs:GetChildren()) do
        if plr.Character and plr.Character.Humanoid.Health > 0 and plr.Name ~= lplr.Name then
            if TeamBased == true then
                if plr.Team.Name ~= plrs.LocalPlayer.Team.Name then
                    local e = espforlder:FindFirstChild(plr.Name)
                    if not e then
                        local bill = Instance.new("BillboardGui", espforlder)
                        bill.Name = plr.Name
                        bill.AlwaysOnTop = true
                        bill.Size = UDim2.new(1, 0, 1, 0)
                        bill.Adornee = plr.Character.Head
                        local Frame = Instance.new('Frame', bill)
                        Frame.Active = true
                        Frame.BackgroundColor3 = Color3.new(0, 1, 0)
                        Frame.BackgroundTransparency = 0
                        Frame.BorderSizePixel = 0
                        Frame.AnchorPoint = Vector2.new(0.5, 0.5)
                        Frame.Position = UDim2.new(0.5, 0, 0.5, 0)
                        Frame.Size = UDim2.new(1, 0, 1, 0)
                        plr.Character.Humanoid.Died:Connect(function()
                            bill:Destroy()
                        end)
                    end
                end
            else
                local e = espforlder:FindFirstChild(plr.Name)
                if not e then
                    local bill = Instance.new("BillboardGui", espforlder)
                    bill.Name = plr.Name
                    bill.AlwaysOnTop = true
                    bill.Size = UDim2.new(1, 0, 1, 0)
                    bill.Adornee = plr.Character.Head
                    local Frame = Instance.new('Frame', bill)
                    Frame.Active = true
                    Frame.BackgroundColor3 = Color3.new(0, 1, 0)
                    Frame.BackgroundTransparency = 0
                    Frame.BorderSizePixel = 0
                    Frame.AnchorPoint = Vector2.new(0.5, 0.5)
                    Frame.Position = UDim2.new(0.5, 0, 0.5, 0)
                    Frame.Size = UDim2.new(1, 0, 1, 0)
                    plr.Character.Humanoid.Died:Connect(function()
                        bill:Destroy()
                    end)
                end
            end
        end
    end
end

-- Kullanıcı girişi
local UserInputService = game:GetService("UserInputService")

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == teambasedswitch then
            TeamBased = not TeamBased
            teambasedstatus.Text = tostring(TeamBased)
        elseif input.KeyCode == aimkey then
            if not aimatpart then
                local maxangle = math.rad(20)
                for i, plr in pairs(plrs:GetChildren()) do
                    if plr.Name ~= lplr.Name and plr.Character and plr.Character[_G.aimpartwexn] and plr.Character.Humanoid and plr.Character.Humanoid.Health > 1 then
                        if TeamBased == true then
                            if plr.Team.Name ~= lplr.Team.Name then
                                local an = checkfov(plr.Character[_G.aimpartwexn])
                                if an < maxangle then
                                    maxangle = an
                                    aimatpart = plr.Character[_G.aimpartwexn]
                                end
                            end
                        else
                            local an = checkfov(plr.Character[_G.aimpartwexn])
                            if an < maxangle then
                                maxangle = an
                                aimatpart = plr.Character[_G.aimpartwexn]
                            end
                        end
                    end
                end
            else
                aimatpart = nil
            end
        end
    end
end)

-- Aim logic
function aimat(part)
    cam.CFrame = CFrame.new(cam.CFrame.p, part.CFrame.p)
end

-- FOV kontrol fonksiyonu
function checkfov(part)
    local fov = getfovxyz(game.Workspace.CurrentCamera.CFrame, part.CFrame)
    local angle = math.abs(fov.X) + math.abs(fov.Y)
    return angle
end

game:GetService("RunService").RenderStepped:Connect(function()
    if aimatpart then
        aimat(aimatpart)
        if aimatpart.Parent == plrs.LocalPlayer.Character then
            aimatpart = nil
        end
    end
end)

-- ESP güncelleme
delay(0, function()
    while wait(espupdatetime) do
        if autoesp == true then
            pcall(function()
                f.addesp()
            end)
        end
    end
end)
